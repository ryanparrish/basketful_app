{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-main">
    <h1>Create Combined Order</h1>
    
    <div style="background-color: #e8f4f8; border-left: 4px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
        <h3 style="margin-top: 0; color: #1976D2;">
            <span style="font-size: 1.2em;">ℹ️</span> Instructions
        </h3>
        <ol style="margin-bottom: 0; line-height: 1.8;">
            <li><strong>Specify the date range:</strong> Select the program, start date, and end date for the orders you want to combine.</li>
            <li><strong>Create the combined order:</strong> Click "Create Combined Order" to generate a new combined order with a timestamp-based name.</li>
            <li><strong>Download the PDF:</strong> After creation, you'll be redirected to the Combined Orders list. Select your newly created order and use the "Download Combined Order PDF" action.</li>
        </ol>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" action="">
        {% csrf_token %}
        
        <fieldset class="module aligned">
            <h2>Select Program and Time Frame</h2>
            
            <div class="form-row">
                {{ form.program.errors }}
                <div>
                    <label for="{{ form.program.id_for_label }}">{{ form.program.label }}:</label>
                    {{ form.program }}
                    {% if form.program.help_text %}
                        <p class="help">{{ form.program.help_text }}</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-row">
                {{ form.start_date.errors }}
                <div>
                    <label for="{{ form.start_date.id_for_label }}">{{ form.start_date.label }}:</label>
                    {{ form.start_date }}
                    {% if form.start_date.help_text %}
                        <p class="help">{{ form.start_date.help_text }}</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-row">
                {{ form.end_date.errors }}
                <div>
                    <label for="{{ form.end_date.id_for_label }}">{{ form.end_date.label }}:</label>
                    {{ form.end_date }}
                    {% if form.end_date.help_text %}
                        <p class="help">{{ form.end_date.help_text }}</p>
                    {% endif %}
                </div>
            </div>
            
            {% if form.non_field_errors %}
                <div class="form-row">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
        </fieldset>
        
        <div class="submit-row">
            <input type="submit" value="Create Combined Order" class="default">
            <a href="{% url 'admin:orders_combinedorder_changelist' %}" class="button cancel-link">Cancel</a>
        </div>
    </form>

    {% if preview_orders %}
        <div class="module">
            <h2>Preview: Orders to be Combined ({{ preview_orders|length }})</h2>
            <table>
                <thead>
                    <tr>
                        <th>Order Number</th>
                        <th>Date</th>
                        <th>Participant</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in preview_orders %}
                        <tr>
                            <td>{{ order.order_number }}</td>
                            <td>{{ order.order_date|date:"Y-m-d" }}</td>
                            <td>{{ order.account.participant }}</td>
                            <td>${{ order.total_price }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4">No orders found for the selected criteria.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</div>
{% endblock %}
